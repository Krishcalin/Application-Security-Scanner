# lamp_apache.conf
# Intentionally misconfigured Apache HTTP Server config for scanner testing.
# Apache httpd version: 2.4.49
# DO NOT use in production â€” this file exists solely as a scan target.

ServerRoot "/etc/httpd"

# --- LAMP-APACHE-001: ServerTokens not set to Prod (exposes version) ---
ServerTokens Full

# --- LAMP-APACHE-002: ServerSignature On (appends version to error pages) ---
ServerSignature On

# --- LAMP-APACHE-003: TraceEnable On (HTTP TRACE enabled) ---
TraceEnable On

Listen 80

LoadModule auth_basic_module modules/mod_auth_basic.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule ssl_module modules/mod_ssl.so
LoadModule status_module modules/mod_status.so
LoadModule info_module modules/mod_info.so

ServerAdmin webmaster@example.com
ServerName www.example.com:80

# --- LAMP-APACHE-022: Timeout set too high (Slowloris DoS) ---
Timeout 600

DocumentRoot "/var/www/html"

<Directory "/var/www/html">
    # --- LAMP-APACHE-004: Options Indexes (directory listing) ---
    # --- LAMP-APACHE-005: FollowSymLinks (symlink traversal) ---
    Options Indexes FollowSymLinks

    # --- LAMP-APACHE-006: AllowOverride All (unrestricted .htaccess) ---
    AllowOverride All

    # --- LAMP-APACHE-025: Deprecated Apache 2.2 access control ---
    Order allow,deny
    # --- LAMP-APACHE-015: Allow from all ---
    Allow from all
</Directory>

<Directory "/var/www/html/uploads">
    # --- LAMP-APACHE-029: PHP engine enabled in upload directory ---
    php_flag engine on
    # --- LAMP-APACHE-030: ExecCGI in upload directory ---
    Options ExecCGI
    AddHandler cgi-script .php .pl
</Directory>

# --- LAMP-APACHE-007: ProxyRequests On (open HTTP proxy) ---
ProxyRequests On
<Proxy "*">
    Order deny,allow
    Allow from all
</Proxy>

# --- LAMP-APACHE-014: LimitRequestBody 0 (no request size limit) ---
LimitRequestBody 0

# --- LAMP-APACHE-012: mod_status exposed without IP restriction ---
<Location "/server-status">
    SetHandler server-status
    Order allow,deny
    Allow from all
</Location>

# --- LAMP-APACHE-013: mod_info exposed ---
<Location "/server-info">
    SetHandler server-info
    Order allow,deny
    Allow from all
</Location>

# --- LAMP-APACHE-023: Access log disabled ---
CustomLog /dev/null combined

# --- LAMP-APACHE-024: MultiViews enabled ---
<Directory "/var/www/html/content">
    Options MultiViews
</Directory>

# --- LAMP-APACHE-016: register_globals enabled via Apache ---
php_value register_globals on

# Weak RewriteRule with proxy flag
# --- LAMP-APACHE-020: RewriteRule with [P] proxy flag (SSRF risk) ---
RewriteEngine On
RewriteRule ^/proxy/(.*)$ http://internal-backend/$1 [P,L]

# SSL VirtualHost configuration
<VirtualHost *:443>
    ServerName secure.example.com

    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/server.crt
    SSLCertificateKeyFile /etc/ssl/private/server.key

    # --- LAMP-APACHE-008: SSLProtocol all (includes SSLv3, TLSv1.0) ---
    SSLProtocol all

    # --- LAMP-APACHE-009: SSLv3 explicitly referenced ---
    # SSLProtocol SSLv3 TLSv1 TLSv1.1 TLSv1.2

    # --- LAMP-APACHE-010: Weak ciphers including RC4 and NULL ---
    SSLCipherSuite RC4-SHA:DES-CBC3-SHA:NULL-SHA:EXPORT56-RC4-MD5

    # --- LAMP-APACHE-011: SSLVerifyClient none ---
    SSLVerifyClient none

    # --- LAMP-APACHE-026: SSL compression enabled (CRIME attack) ---
    SSLCompression on

    # --- LAMP-APACHE-017: X-Frame-Options allowing all framing ---
    Header set X-Frame-Options "ALLOW"

    # --- LAMP-APACHE-018: HSTS max-age too short (300 seconds) ---
    Header always set Strict-Transport-Security "max-age=300"

    # --- LAMP-APACHE-019: CSP with unsafe-inline and unsafe-eval ---
    Header always set Content-Security-Policy "default-src 'self' 'unsafe-inline' 'unsafe-eval'"

    # --- LAMP-APACHE-028: HTTP/2 over cleartext ---
    Protocols h2c http/1.1

    DocumentRoot "/var/www/html"
</VirtualHost>

# NOTE: Missing security headers (detected by whole-file absence checks):
# - No X-Content-Type-Options header       -> LAMP-APACHE-F04
# - No X-Frame-Options with DENY/SAMEORIGIN-> LAMP-APACHE-F05 (overridden above with ALLOW)
# - No Strict-Transport-Security proper    -> LAMP-APACHE-F06
# - No Content-Security-Policy proper      -> LAMP-APACHE-F07
# - No Referrer-Policy                     -> LAMP-APACHE-F08
# - No Permissions-Policy                  -> LAMP-APACHE-F09
# - No ServerTokens Prod                   -> LAMP-APACHE-F01
# - No ServerSignature Off                 -> LAMP-APACHE-F02
# - No TraceEnable Off                     -> LAMP-APACHE-F03
